# ü§ñ Auto-Documentation Bot

Automated documentation generation from commit messages for pull requests and project tracking.

## Overview

This bot automatically:
- ‚úÖ Parses commit messages (supports conventional commits)
- ‚úÖ Generates comprehensive documentation
- ‚úÖ Posts/updates PR comments with change summaries
- ‚úÖ Handles errors gracefully with detailed reporting
- ‚úÖ Creates artifacts for review

## Components

### 1. `parse-commits.js`
Parses git commits and extracts structured information.

**Features:**
- Conventional commit parsing (feat, fix, docs, etc.)
- File change tracking (added, modified, deleted)
- Commit statistics (insertions, deletions)
- Breaking change detection
- Error handling and logging

**Outputs:**
- `commits-data.json` - Structured commit data

### 2. `generate-docs.js`
Generates markdown documentation from parsed commit data.

**Features:**
- Full documentation with statistics
- Compact PR comments with collapsible sections
- Breaking change alerts
- File change summaries
- Commit history tables

**Outputs:**
- `COMMIT_DOCS.md` - Full documentation
- `pr-comment.md` - PR comment template
- `summary.md` - Actions summary

### 3. `post-comment.js`
Posts generated documentation as PR comments.

**Features:**
- Creates new comments or updates existing ones
- GitHub API integration
- Error handling for API failures
- Comment deduplication

### 4. `error-handler.js`
Handles errors and generates diagnostic reports.

**Features:**
- Detailed error reporting
- Troubleshooting guides
- Optional PR error comments
- Error log aggregation

## Workflow Triggers

The workflow runs on:
- **Push** to `claude/**`, `feat/**`, `docs/**` branches
- **Pull Requests** (opened, synchronized, reopened)
- **Manual** via workflow_dispatch

## Configuration

### Environment Variables

```bash
# GitHub (automatically provided)
GITHUB_TOKEN         # GitHub API token
GITHUB_REPOSITORY    # Repository (owner/repo)
GITHUB_SHA           # Commit SHA
GITHUB_REF_NAME      # Branch name

# Pull Request
PR_NUMBER            # PR number (if applicable)

# Git References
BASE_REF             # Base commit/branch for comparison
HEAD_REF             # Head commit for comparison
```

### Permissions Required

```yaml
permissions:
  contents: write        # Read repository and commits
  pull-requests: write   # Post PR comments
  issues: write          # Post issue comments
```

## Usage

### Automatic

The workflow runs automatically on supported branches and PRs. No manual intervention needed.

### Manual

```bash
# Trigger via GitHub UI
# Actions ‚Üí Auto-Document Commits ‚Üí Run workflow

# Or via gh CLI
gh workflow run auto-document.yml
```

### Local Testing

```bash
# Install dependencies
npm install @actions/core @actions/github conventional-commits-parser

# Run parser
export BASE_REF=HEAD~5
export HEAD_REF=HEAD
export BRANCH_NAME=$(git branch --show-current)
node .github/scripts/parse-commits.js

# Run generator
node .github/scripts/generate-docs.js

# View output
cat .github/generated-docs/COMMIT_DOCS.md
cat .github/generated-docs/pr-comment.md
```

## Commit Message Format

### Conventional Commits (Recommended)

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Types:**
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation
- `style`: Code style (formatting, etc.)
- `refactor`: Code refactoring
- `perf`: Performance improvement
- `test`: Tests
- `build`: Build system
- `ci`: CI/CD
- `chore`: Maintenance

**Examples:**

```
feat(auth): add hardware wallet support

Implement Ledger and Trezor integration with flexible signer factory.
Co-signers can now use hardware wallets or software wallets.

Closes #123
```

```
fix(router): correct fee calculation for edge case

BREAKING CHANGE: Fee calculation now rounds down instead of up
```

```
docs: update README with new deployment instructions
```

### Non-Conventional Commits

The bot also works with regular commit messages:

```
Add new feature for user authentication
Fix bug in payment processor
Update documentation
```

## Output Examples

### PR Comment

````markdown
## ‚úÖ Auto-Generated Documentation

**Summary:** 5 commit(s) | 21 file(s) changed | +6188/-107 lines

### üìù Changes

<details>
<summary>‚ú® <strong>Features</strong> (2)</summary>

- **auth**: Add hardware wallet support (`abc123`)
- **multisig**: Implement three-level hierarchy (`def456`)

</details>

### üìÅ Key Files

- ‚ú® `scripts/deploy-hardware-wallet.ts` (added)
- ‚ú® `scripts/deploy-multisig.ts` (added)
- ‚úèÔ∏è `package.json` (modified)

---
ü§ñ Auto-generated by commit documentation workflow
````

### Full Documentation

See `.github/generated-docs/COMMIT_DOCS.md` for complete example.

## Error Handling

### Error Levels

1. **Parsing Errors**
   - Git command failures
   - Invalid commit messages
   - File system issues

2. **Generation Errors**
   - Missing or corrupted data
   - Markdown formatting issues
   - Output file creation failures

3. **Posting Errors**
   - GitHub API failures
   - Authentication issues
   - Rate limiting

### Error Recovery

The workflow:
- Continues on non-fatal errors
- Generates error reports
- Posts error comments to PRs
- Uploads error logs as artifacts

### Troubleshooting

Check workflow artifacts:
- `commit-documentation-<sha>/` - Generated docs and logs
- `errors.log` - Detailed error messages
- `error-report.md` - Comprehensive error analysis

## Artifacts

All runs generate artifacts (retained for 30 days):

```
commit-documentation-<sha>/
‚îú‚îÄ‚îÄ generated-docs/
‚îÇ   ‚îú‚îÄ‚îÄ commits-data.json     # Parsed commit data
‚îÇ   ‚îú‚îÄ‚îÄ COMMIT_DOCS.md        # Full documentation
‚îÇ   ‚îú‚îÄ‚îÄ pr-comment.md         # PR comment content
‚îÇ   ‚îî‚îÄ‚îÄ summary.md            # Actions summary
‚îî‚îÄ‚îÄ logs/
    ‚îú‚îÄ‚îÄ errors.log            # Error log
    ‚îî‚îÄ‚îÄ error-report.md       # Error report (if errors occurred)
```

## Customization

### Modify Commit Types

Edit `parse-commits.js`:

```javascript
const commitTypes = {
  feat: { label: '‚ú® Features', description: 'New features' },
  // Add custom types
  custom: { label: 'üé® Custom', description: 'Custom changes' },
};
```

### Customize PR Comment Format

Edit `generate-docs.js` ‚Üí `generatePRComment()` function.

### Add Custom Sections

Edit `generate-docs.js` ‚Üí `generateMarkdown()` function.

## Best Practices

1. **Use Conventional Commits** - Provides better categorization
2. **Write Descriptive Messages** - Improves documentation quality
3. **Include Scope** - Helps organize changes by component
4. **Mark Breaking Changes** - Alerts reviewers to important changes
5. **Reference Issues** - Links documentation to issue tracker

## Integration

### With Version Control

The bot integrates with:
- VERSION.md updates
- CHANGELOG.md generation
- Release notes

### With CI/CD

The workflow runs alongside:
- Testing workflows
- Linting workflows
- Deployment workflows

## Maintenance

### Updating Dependencies

```bash
cd .github/scripts
npm update
```

### Logs Cleanup

Logs are automatically cleaned:
- Artifacts retained for 30 days
- Error logs rotated on each run

## Security

- ‚úÖ Uses GitHub's provided `GITHUB_TOKEN`
- ‚úÖ No secrets in commit messages or logs
- ‚úÖ API tokens not exposed in outputs
- ‚úÖ Minimal permissions required

## Support

For issues or questions:
1. Check workflow logs in Actions tab
2. Review error reports in artifacts
3. File issue at: `github.com/Fused-Gaming/stablecoin-aggregators/issues`

## License

Part of the Stablecoin Aggregators project.

---

*Auto-Documentation Bot - Making commit documentation effortless ü§ñ*
